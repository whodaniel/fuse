"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AdvancedGraphAlgorithms = void 0;
class AdvancedGraphAlgorithms {
    constructor(nodes, edges) {
        this.nodes = nodes;
        this.edges = edges;
        this.nodeIndices = new Map(nodes.map((node, i) => [node.id, i]));
        this.adjacencyMatrix = this.buildAdjacencyMatrix();
        this.laplacianMatrix = this.buildLaplacianMatrix();
    }
    buildAdjacencyMatrix() {
        const n = this.nodes.length;
        const matrix = Array(n).fill(0).map(() => Array(n).fill(0));
        this.edges.forEach(edg(e: any) => {
            const sourceIdx = this.nodeIndices.get(edge.source);
            const targetIdx = this.nodeIndices.get(edge.target);
            if (sourceIdx !== undefined && targetIdx !== undefined) {
                matrix[sourceIdx][targetIdx] = 1;
                matrix[targetIdx][sourceIdx] = 1;
            }
        });
        return matrix;
    }
    buildLaplacianMatrix() {
        const n = this.nodes.length;
        const matrix = Array(n).fill(0).map(() => Array(n).fill(0));
        const degrees = this.adjacencyMatrix.map(row => row.reduce((a, b) => a + b, 0));
        for (let i = 0; i < n; i++) {
            matrix[i][i] = degrees[i];
            for (let j = 0; j < n; j++) {
                if (i !== j) {
                    matrix[i][j] = -this.adjacencyMatrix[i][j];
                }
            }
        }
        return matrix;
    }
    powerIteration(matrix, iterations = 100) {
        const n = matrix.length;
        let vector = Array(n).fill(1 / Math.sqrt(n));
        let eigenvalue = 0;
        for (let iter = 0; iter < iterations; iter++) {
            const newVector = Array(n).fill(0);
            // Matrix-vector multiplication
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    newVector[i] += matrix[i][j] * vector[j];
                }
            }
            // Normalize
            const norm = Math.sqrt(newVector.reduce((a, b) => a + b * b, 0));
            vector = newVector.map(v => v / norm);
            // Calculate eigenvalue
            eigenvalue = vector.reduce((sum, v, i) => {
                return sum + v * (matrix[i].reduce((s, m, j) => s + m * vector[j], 0));
            }, 0);
        }
        return [vector, eigenvalue];
    }
    calculateEigenvectorCentrality() {
        const [eigenvector] = this.powerIteration(this.adjacencyMatrix);
        return new Map(this.nodes.map((node, i) => [node.id, eigenvector[i]]));
    }
    calculateKatzCentrality(alpha = 0.1) {
        const n = this.nodes.length;
        const beta = 1;
        const identity = Array(n).fill(0).map((_, i) => Array(n).fill(0).map((_, j) => i === j ? 1 : 0));
        // Calculate (I - αA)^(-1) * β1
        const matrix = identity.map((row, i) => row.map((val, j) => val - alpha * this.adjacencyMatrix[i][j]));
        // Simple Gaussian elimination for matrix inversion
        const katz = Array(n).fill(beta);
        for (let i = 0; i < n; i++) {
            const pivot = matrix[i][i];
            for (let j = i + 1; j < n; j++) {
                const factor = matrix[j][i] / pivot;
                for (let k = i; k < n; k++) {
                    matrix[j][k] -= factor * matrix[i][k];
                }
                katz[j] -= factor * katz[i];
            }
        }
        for (let i = n - 1; i >= 0; i--) {
            for (let j = i + 1; j < n; j++) {
                katz[i] -= matrix[i][j] * katz[j];
            }
            katz[i] /= matrix[i][i];
        }
        return new Map(this.nodes.map((node, i) => [node.id, katz[i]]));
    }
    calculateSpectralProperties() {
        // Calculate first few eigenvalues and eigenvectors
        const numEigenvalues = Math.min(5, this.nodes.length);
        const eigenvalues = [];
        const eigenvectors = [];
        let matrix = this.adjacencyMatrix.map(row => [...row]);
        for (let i = 0; i < numEigenvalues; i++) {
            const [eigenvector, eigenvalue] = this.powerIteration(matrix);
            eigenvalues.push(eigenvalue);
            eigenvectors.push(eigenvector);
            // Deflate matrix for next eigenvalue
            for (let j = 0; j < matrix.length; j++) {
                for (let k = 0; k < matrix.length; k++) {
                    matrix[j][k] -= eigenvalue * eigenvector[j] * eigenvector[k];
                }
            }
        }
        // Calculate Laplacian spectrum
        const [_, laplacianEigenvalue] = this.powerIteration(this.laplacianMatrix);
        const laplacianSpectrum = [laplacianEigenvalue];
        return {
            eigenvalues,
            eigenvectors,
            laplacianSpectrum
        };
    }
    detectStructuralHoles() {
        const constraints = new Map();
        this.nodes.forEach(nod(e: any) => {
            const neighbors = this.edges
                .filter((e: any) => e.source === node.id || e.target === node.id)
                .map((e: any) => e.source === node.id ? e.target : e.source);
            if (neighbors.length < 2) {
                constraints.set(node.id, 0);
                return;
            }
            let constraint = 0;
            neighbors.forEach(neighbor1 => {
                neighbors.forEach(neighbor2 => {
                    if (neighbor1 !== neighbor2) {
                        const hasConnection = this.edges.some((e: any) => (e.source === neighbor1 && e.target === neighbor2) ||
                            (e.source === neighbor2 && e.target === neighbor1));
                        if (hasConnection) {
                            constraint += 1 / (neighbors.length * neighbors.length);
                        }
                    }
                });
            });
            constraints.set(node.id, 1 - constraint);
        });
        return constraints;
    }
    findCorePeriphery() {
        const degrees = new Map();
        this.nodes.forEach(nod(e: any) => {
            degrees.set(node.id, this.edges.filter((e: any) => e.source === node.id || e.target === node.id).length);
        });
        // Use k-means with k=2 to separate core from periphery
        const sortedNodes = [...degrees.entries()].sort((a, b) => b[1] - a[1]);
        const medianDegree = sortedNodes[Math.floor(sortedNodes.length / 2)][1];
        const core = new Set();
        const periphery = new Set();
        sortedNodes.forEach(([nodeId, degree]) => {
            if (degree > medianDegree) {
                core.add(nodeId);
            }
            else {
                periphery.add(nodeId);
            }
        });
        return { core, periphery };
    }
    calculateAllMetrics() {
        const eigenvectorCentrality = this.calculateEigenvectorCentrality();
        const katzCentrality = this.calculateKatzCentrality();
        const spectralProperties = this.calculateSpectralProperties();
        const structuralHoles = this.detectStructuralHoles();
        const { core, periphery } = this.findCorePeriphery();
        // Calculate degree centrality
        const degreeCentrality = new Map();
        this.nodes.forEach(nod(e: any) => {
            degreeCentrality.set(node.id, this.edges.filter((e: any) => e.source === node.id || e.target === node.id).length);
        });
        // Calculate clustering coefficients
        const localCoefficients = new Map();
        let globalCoefficient = 0;
        this.nodes.forEach(nod(e: any) => {
            const neighbors = this.edges
                .filter((e: any) => e.source === node.id || e.target === node.id)
                .map((e: any) => e.source === node.id ? e.target : e.source);
            if (neighbors.length < 2) {
                localCoefficients.set(node.id, 0);
                return;
            }
            let triangles = 0;
            for (let i = 0; i < neighbors.length; i++) {
                for (let j = i + 1; j < neighbors.length; j++) {
                    if (this.edges.some((e: any) => (e.source === neighbors[i] && e.target === neighbors[j]) ||
                        (e.source === neighbors[j] && e.target === neighbors[i]))) {
                        triangles++;
                    }
                }
            }
            const coefficient = (2 * triangles) / (neighbors.length * (neighbors.length - 1));
            localCoefficients.set(node.id, coefficient);
            globalCoefficient += coefficient;
        });
        globalCoefficient /= this.nodes.length;
        // Assign communities based on core-periphery structure
        const communities = new Map();
        core.forEach(nodeId => communities.set(nodeId, 1));
        periphery.forEach(nodeId => communities.set(nodeId, 0));
        return {
            centrality: {
                degree: degreeCentrality,
                betweenness: new Map(), // Calculated in base class
                closeness: new Map(), // Calculated in base class
                eigenvector: eigenvectorCentrality,
                katz: katzCentrality
            },
            clustering: {
                globalCoefficient,
                localCoefficients,
                communities
            },
            paths: {
                averagePathLength: 0, // Requires all-pairs shortest paths
                diameter: 0, // Requires all-pairs shortest paths
                eccentricity: new Map() // Requires all-pairs shortest paths
            },
            spectral: spectralProperties
        };
    }
}
exports.AdvancedGraphAlgorithms = AdvancedGraphAlgorithms;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWR2YW5jZWRHcmFwaEFsZ29yaXRobXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBZHZhbmNlZEdyYXBoQWxnb3JpdGhtcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUE4QkEsTUFBYSx1QkFBdUI7SUFPaEMsWUFBWSxLQUFrQixFQUFFLEtBQWtCO1FBQzlDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUNuRCxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO0lBQ3ZELENBQUM7SUFFTyxvQkFBb0I7UUFDeEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDNUIsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTVELElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3RCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNwRCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcs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QUNuRCxTQUFTLEVBQUUsSUFBSSxHQUFHLEVBQUUsRUFBSSwyQkFBMkI7Z0JBQ25ELFdBQVcsRUFBRSxxQkFBcUI7Z0JBQ2xDLElBQUksRUFBRSxjQUFjO2FBQ3ZCO1lBQ0QsVUFBVSxFQUFFO2dCQUNSLGlCQUFpQjtnQkFDakIsaUJBQWlCO2dCQUNqQixXQUFXO2FBQ2Q7WUFDRCxLQUFLLEVBQUU7Z0JBQ0gsaUJBQWlCLEVBQUUsQ0FBQyxFQUFJLG9DQUFvQztnQkFDNUQsUUFBUSxFQUFFLENBQUMsRUFBYSxvQ0FBb0M7Z0JBQzVELFlBQVksRUFBRSxJQUFJLEdBQUcsRUFBRSxDQUFDLG9DQUFvQzthQUMvRDtZQUNELFFBQVEsRUFBRSxrQkFBa0I7U0FDL0IsQ0FBQztJQUNOLENBQUM7Q0FDSjtBQTNSRCwwREEyUkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFkdmFuY2VkR3JhcGhBbGdvcml0aG1zIC0gRXh0ZW5kZWQgZ3JhcGggYW5hbHlzaXMgY2FwYWJpbGl0aWVzXG4gKi9cbmltcG9ydCB7IEdyYXBoTm9kZSwgR3JhcGhFZGdlIH0gZnJvbSAnLi4vLi4vc2hhcmVkL3R5cGVzJztcblxuZXhwb3J0IGludGVyZmFjZSBHcmFwaE1ldHJpY3Mge1xuICAgIGNlbnRyYWxpdHk6IHtcbiAgICAgICAgZGVncmVlOiBNYXA8c3RyaW5nLCBudW1iZXI+O1xuICAgICAgICBiZXR3ZWVubmVzczogTWFwPHN0cmluZywgbnVtYmVyPjtcbiAgICAgICAgY2xvc2VuZXNzOiBNYXA8c3RyaW5nLCBudW1iZXI+O1xuICAgICAgICBlaWdlbnZlY3RvcjogTWFwPHN0cmluZywgbnVtYmVyPjtcbiAgICAgICAga2F0ejogTWFwPHN0cmluZywgbnVtYmVyPjtcbiAgICB9O1xuICAgIGNsdXN0ZXJpbmc6IHtcbiAgICAgICAgZ2xvYmFsQ29lZmZpY2llbnQ6IG51bWJlcjtcbiAgICAgICAgbG9jYWxDb2VmZmljaWVudHM6IE1hcDxzdHJpbmcsIG51bWJlcj47XG4gICAgICAgIGNvbW11bml0aWVzOiBNYXA8c3RyaW5nLCBudW1iZXI+O1xuICAgIH07XG4gICAgcGF0aHM6IHtcbiAgICAgICAgYXZlcmFnZVBhdGhMZW5ndGg6IG51bWJlcjtcbiAgICAgICAgZGlhbWV0ZXI6IG51bWJlcjtcbiAgICAgICAgZWNjZW50cmljaXR5OiBNYXA8c3RyaW5nLCBudW1iZXI+O1xuICAgIH07XG4gICAgc3BlY3RyYWw6IHtcbiAgICAgICAgZWlnZW52YWx1ZXM6IG51bWJlcltdO1xuICAgICAgICBlaWdlbnZlY3RvcnM6IG51bWJlcltdW107XG4gICAgICAgIGxhcGxhY2lhblNwZWN0cnVtOiBudW1iZXJbXTtcbiAgICB9O1xufVxuXG5leHBvcnQgY2xhc3MgQWR2YW5jZWRHcmFwaEFsZ29yaXRobXMge1xuICAgIHByaXZhdGUgbm9kZXM6IEdyYXBoTm9kZVtdO1xuICAgIHByaXZhdGUgZWRnZXM6IEdyYXBoRWRnZVtdO1xuICAgIHByaXZhdGUgYWRqYWNlbmN5TWF0cml4OiBudW1iZXJbXVtdO1xuICAgIHByaXZhdGUgbGFwbGFjaWFuTWF0cml4OiBudW1iZXJbXVtdO1xuICAgIHByaXZhdGUgbm9kZUluZGljZXM6IE1hcDxzdHJpbmcsIG51bWJlcj47XG5cbiAgICBjb25zdHJ1Y3Rvcihub2RlczogR3JhcGhOb2RlW10sIGVkZ2VzOiBHcmFwaEVkZ2VbXSkge1xuICAgICAgICB0aGlzLm5vZGVzID0gbm9kZXM7XG4gICAgICAgIHRoaXMuZWRnZXMgPSBlZGdlcztcbiAgICAgICAgdGhpcy5ub2RlSW5kaWNlcyA9IG5ldyBNYXAobm9kZXMubWFwKChub2RlLCBpKSA9PiBbbm9kZS5pZCwgaV0pKTtcbiAgICAgICAgdGhpcy5hZGphY2VuY3lNYXRyaXggPSB0aGlzLmJ1aWxkQWRqYWNlbmN5TWF0cml4KCk7XG4gICAgICAgIHRoaXMubGFwbGFjaWFuTWF0cml4ID0gdGhpcy5idWlsZExhcGxhY2lhbk1hdHJpeCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYnVpbGRBZGphY2VuY3lNYXRyaXgoKTogbnVtYmVyW11bXSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLm5vZGVzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgbWF0cml4ID0gQXJyYXkobikuZmlsbCgwKS5tYXAoKCkgPT4gQXJyYXkobikuZmlsbCgwKSk7XG5cbiAgICAgICAgdGhpcy5lZGdlcy5mb3JFYWNoKGVkZ2UgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc291cmNlSWR4ID0gdGhpcy5ub2RlSW5kaWNlcy5nZXQoZWRnZS5zb3VyY2UpO1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0SWR4ID0gdGhpcy5ub2RlSW5kaWNlcy5nZXQoZWRnZS50YXJnZXQpO1xuICAgICAgICAgICAgaWYgKHNvdXJjZUlkeCAhPT0gdW5kZWZpbmVkICYmIHRhcmdldElkeCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbWF0cml4W3NvdXJjZUlkeF1bdGFyZ2V0SWR4XSA9IDE7XG4gICAgICAgICAgICAgICAgbWF0cml4W3RhcmdldElkeF1bc291cmNlSWR4XSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBtYXRyaXg7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBidWlsZExhcGxhY2lhbk1hdHJpeCgpOiBudW1iZXJbXVtdIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMubm9kZXMubGVuZ3RoO1xuICAgICAgICBjb25zdCBtYXRyaXggPSBBcnJheShuKS5maWxsKDApLm1hcCgoKSA9PiBBcnJheShuKS5maWxsKDApKTtcbiAgICAgICAgY29uc3QgZGVncmVlcyA9IHRoaXMuYWRqYWNlbmN5TWF0cml4Lm1hcChyb3cgPT4gcm93LnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgbWF0cml4W2ldW2ldID0gZGVncmVlc1tpXTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbjsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGkgIT09IGopIHtcbiAgICAgICAgICAgICAgICAgICAgbWF0cml4W2ldW2pdID0gLXRoaXMuYWRqYWNlbmN5TWF0cml4W2ldW2pdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtYXRyaXg7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwb3dlckl0ZXJhdGlvbihtYXRyaXg6IG51bWJlcltdW10sIGl0ZXJhdGlvbnM6IG51bWJlciA9IDEwMCk6IFtudW1iZXJbXSwgbnVtYmVyXSB7XG4gICAgICAgIGNvbnN0IG4gPSBtYXRyaXgubGVuZ3RoO1xuICAgICAgICBsZXQgdmVjdG9yID0gQXJyYXkobikuZmlsbCgxIC8gTWF0aC5zcXJ0KG4pKTtcbiAgICAgICAgbGV0IGVpZ2VudmFsdWUgPSAwO1xuXG4gICAgICAgIGZvciAobGV0IGl0ZXIgPSAwOyBpdGVyIDwgaXRlcmF0aW9uczsgaXRlcisrKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdWZWN0b3IgPSBBcnJheShuKS5maWxsKDApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBNYXRyaXgtdmVjdG9yIG11bHRpcGxpY2F0aW9uXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbjsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1ZlY3RvcltpXSArPSBtYXRyaXhbaV1bal0gKiB2ZWN0b3Jbal07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBOb3JtYWxpemVcbiAgICAgICAgICAgIGNvbnN0IG5vcm0gPSBNYXRoLnNxcnQobmV3VmVjdG9yLnJlZHVjZSgoYSwgYikgPT4gYSArIGIgKiBiLCAwKSk7XG4gICAgICAgICAgICB2ZWN0b3IgPSBuZXdWZWN0b3IubWFwKHYgPT4gdiAvIG5vcm0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgZWlnZW52YWx1ZVxuICAgICAgICAgICAgZWlnZW52YWx1ZSA9IHZlY3Rvci5yZWR1Y2UoKHN1bSwgdiwgaSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyB2ICogKG1hdHJpeFtpXS5yZWR1Y2UoKHMsIG0sIGopID0+IHMgKyBtICogdmVjdG9yW2pdLCAwKSk7XG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBbdmVjdG9yLCBlaWdlbnZhbHVlXTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2FsY3VsYXRlRWlnZW52ZWN0b3JDZW50cmFsaXR5KCk6IE1hcDxzdHJpbmcsIG51bWJlcj4ge1xuICAgICAgICBjb25zdCBbZWlnZW52ZWN0b3JdID0gdGhpcy5wb3dlckl0ZXJhdGlvbih0aGlzLmFkamFjZW5jeU1hdHJpeCk7XG4gICAgICAgIHJldHVybiBuZXcgTWFwKHRoaXMubm9kZXMubWFwKChub2RlLCBpKSA9PiBbbm9kZS5pZCwgZWlnZW52ZWN0b3JbaV1dKSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNhbGN1bGF0ZUthdHpDZW50cmFsaXR5KGFscGhhOiBudW1iZXIgPSAwLjEpOiBNYXA8c3RyaW5nLCBudW1iZXI+IHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMubm9kZXMubGVuZ3RoO1xuICAgICAgICBjb25zdCBiZXRhID0gMTtcbiAgICAgICAgY29uc3QgaWRlbnRpdHkgPSBBcnJheShuKS5maWxsKDApLm1hcCgoXywgaSkgPT4gQXJyYXkobikuZmlsbCgwKS5tYXAoKF8sIGopID0+IGkgPT09IGogPyAxIDogMCkpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ2FsY3VsYXRlIChJIC0gzrFBKV4oLTEpICogzrIxXG4gICAgICAgIGNvbnN0IG1hdHJpeCA9IGlkZW50aXR5Lm1hcCgocm93LCBpKSA9PiBcbiAgICAgICAgICAgIHJvdy5tYXAoKHZhbCwgaikgPT4gdmFsIC0gYWxwaGEgKiB0aGlzLmFkamFjZW5jeU1hdHJpeFtpXVtqXSlcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBTaW1wbGUgR2F1c3NpYW4gZWxpbWluYXRpb24gZm9yIG1hdHJpeCBpbnZlcnNpb25cbiAgICAgICAgY29uc3Qga2F0eiA9IEFycmF5KG4pLmZpbGwoYmV0YSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBwaXZvdCA9IG1hdHJpeFtpXVtpXTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IG47IGorKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IG1hdHJpeFtqXVtpXSAvIHBpdm90O1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGsgPSBpOyBrIDwgbjsgaysrKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hdHJpeFtqXVtrXSAtPSBmYWN0b3IgKiBtYXRyaXhbaV1ba107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGthdHpbal0gLT0gZmFjdG9yICoga2F0eltpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IGkgPSBuIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IG47IGorKykge1xuICAgICAgICAgICAgICAgIGthdHpbaV0gLT0gbWF0cml4W2ldW2pdICoga2F0eltqXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGthdHpbaV0gLz0gbWF0cml4W2ldW2ldO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBNYXAodGhpcy5ub2Rlcy5tYXAoKG5vZGUsIGkpID0+IFtub2RlLmlkLCBrYXR6W2ldXSkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjYWxjdWxhdGVTcGVjdHJhbFByb3BlcnRpZXMoKToge1xuICAgICAgICBlaWdlbnZhbHVlczogbnVtYmVyW107XG4gICAgICAgIGVpZ2VudmVjdG9yczogbnVtYmVyW11bXTtcbiAgICAgICAgbGFwbGFjaWFuU3BlY3RydW06IG51bWJlcltdO1xuICAgIH0ge1xuICAgICAgICAvLyBDYWxjdWxhdGUgZmlyc3QgZmV3IGVpZ2VudmFsdWVzIGFuZCBlaWdlbnZlY3RvcnNcbiAgICAgICAgY29uc3QgbnVtRWlnZW52YWx1ZXMgPSBNYXRoLm1pbig1LCB0aGlzLm5vZGVzLmxlbmd0aCk7XG4gICAgICAgIGNvbnN0IGVpZ2VudmFsdWVzOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICBjb25zdCBlaWdlbnZlY3RvcnM6IG51bWJlcltdW10gPSBbXTtcbiAgICAgICAgbGV0IG1hdHJpeCA9IHRoaXMuYWRqYWNlbmN5TWF0cml4Lm1hcChyb3cgPT4gWy4uLnJvd10pO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRWlnZW52YWx1ZXM7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgW2VpZ2VudmVjdG9yLCBlaWdlbnZhbHVlXSA9IHRoaXMucG93ZXJJdGVyYXRpb24obWF0cml4KTtcbiAgICAgICAgICAgIGVpZ2VudmFsdWVzLnB1c2goZWlnZW52YWx1ZSk7XG4gICAgICAgICAgICBlaWdlbnZlY3RvcnMucHVzaChlaWdlbnZlY3Rvcik7XG5cbiAgICAgICAgICAgIC8vIERlZmxhdGUgbWF0cml4IGZvciBuZXh0IGVpZ2VudmFsdWVcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbWF0cml4Lmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBtYXRyaXgubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbWF0cml4W2pdW2tdIC09IGVpZ2VudmFsdWUgKiBlaWdlbnZlY3RvcltqXSAqIGVpZ2VudmVjdG9yW2tdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENhbGN1bGF0ZSBMYXBsYWNpYW4gc3BlY3RydW1cbiAgICAgICAgY29uc3QgW18sIGxhcGxhY2lhbkVpZ2VudmFsdWVdID0gdGhpcy5wb3dlckl0ZXJhdGlvbih0aGlzLmxhcGxhY2lhbk1hdHJpeCk7XG4gICAgICAgIGNvbnN0IGxhcGxhY2lhblNwZWN0cnVtID0gW2xhcGxhY2lhbkVpZ2VudmFsdWVdO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlaWdlbnZhbHVlcyxcbiAgICAgICAgICAgIGVpZ2VudmVjdG9ycyxcbiAgICAgICAgICAgIGxhcGxhY2lhblNwZWN0cnVtXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGRldGVjdFN0cnVjdHVyYWxIb2xlcygpOiBNYXA8c3RyaW5nLCBudW1iZXI+IHtcbiAgICAgICAgY29uc3QgY29uc3RyYWludHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5ub2Rlcy5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgbmVpZ2hib3JzID0gdGhpcy5lZGdlc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoZSA9PiBlLnNvdXJjZSA9PT0gbm9kZS5pZCB8fCBlLnRhcmdldCA9PT0gbm9kZS5pZClcbiAgICAgICAgICAgICAgICAubWFwKGUgPT4gZS5zb3VyY2UgPT09IG5vZGUuaWQgPyBlLnRhcmdldCA6IGUuc291cmNlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKG5laWdoYm9ycy5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICAgICAgY29uc3RyYWludHMuc2V0KG5vZGUuaWQsIDApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IGNvbnN0cmFpbnQgPSAwO1xuICAgICAgICAgICAgbmVpZ2hib3JzLmZvckVhY2gobmVpZ2hib3IxID0+IHtcbiAgICAgICAgICAgICAgICBuZWlnaGJvcnMuZm9yRWFjaChuZWlnaGJvcjIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmVpZ2hib3IxICE9PSBuZWlnaGJvcjIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Nvbm5lY3Rpb24gPSB0aGlzLmVkZ2VzLnNvbWUoZSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlLnNvdXJjZSA9PT0gbmVpZ2hib3IxICYmIGUudGFyZ2V0ID09PSBuZWlnaGJvcjIpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUuc291cmNlID09PSBuZWlnaGJvcjIgJiYgZS50YXJnZXQgPT09IG5laWdoYm9yMSlcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnQgKz0gMSAvIChuZWlnaGJvcnMubGVuZ3RoICogbmVpZ2hib3JzLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdHJhaW50cy5zZXQobm9kZS5pZCwgMSAtIGNvbnN0cmFpbnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gY29uc3RyYWludHM7XG4gICAgfVxuXG4gICAgcHVibGljIGZpbmRDb3JlUGVyaXBoZXJ5KCk6IHsgY29yZTogU2V0PHN0cmluZz47IHBlcmlwaGVyeTogU2V0PHN0cmluZz4gfSB7XG4gICAgICAgIGNvbnN0IGRlZ3JlZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICB0aGlzLm5vZGVzLmZvckVhY2gobm9kZSA9PiB7XG4gICAgICAgICAgICBkZWdyZWVzLnNldChub2RlLmlkLCB0aGlzLmVkZ2VzLmZpbHRlcihlID0+XG4gICAgICAgICAgICAgICAgZS5zb3VyY2UgPT09IG5vZGUuaWQgfHwgZS50YXJnZXQgPT09IG5vZGUuaWRcbiAgICAgICAgICAgICkubGVuZ3RoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVXNlIGstbWVhbnMgd2l0aCBrPTIgdG8gc2VwYXJhdGUgY29yZSBmcm9tIHBlcmlwaGVyeVxuICAgICAgICBjb25zdCBzb3J0ZWROb2RlcyA9IFsuLi5kZWdyZWVzLmVudHJpZXMoKV0uc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pO1xuICAgICAgICBjb25zdCBtZWRpYW5EZWdyZWUgPSBzb3J0ZWROb2Rlc1tNYXRoLmZsb29yKHNvcnRlZE5vZGVzLmxlbmd0aCAvIDIpXVsxXTtcblxuICAgICAgICBjb25zdCBjb3JlID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgICAgIGNvbnN0IHBlcmlwaGVyeSA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG4gICAgICAgIHNvcnRlZE5vZGVzLmZvckVhY2goKFtub2RlSWQsIGRlZ3JlZV0pID0+IHtcbiAgICAgICAgICAgIGlmIChkZWdyZWUgPiBtZWRpYW5EZWdyZWUpIHtcbiAgICAgICAgICAgICAgICBjb3JlLmFkZChub2RlSWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwZXJpcGhlcnkuYWRkKG5vZGVJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IGNvcmUsIHBlcmlwaGVyeSB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBjYWxjdWxhdGVBbGxNZXRyaWNzKCk6IEdyYXBoTWV0cmljcyB7XG4gICAgICAgIGNvbnN0IGVpZ2VudmVjdG9yQ2VudHJhbGl0eSA9IHRoaXMuY2FsY3VsYXRlRWlnZW52ZWN0b3JDZW50cmFsaXR5KCk7XG4gICAgICAgIGNvbnN0IGthdHpDZW50cmFsaXR5ID0gdGhpcy5jYWxjdWxhdGVLYXR6Q2VudHJhbGl0eSgpO1xuICAgICAgICBjb25zdCBzcGVjdHJhbFByb3BlcnRpZXMgPSB0aGlzLmNhbGN1bGF0ZVNwZWN0cmFsUHJvcGVydGllcygpO1xuICAgICAgICBjb25zdCBzdHJ1Y3R1cmFsSG9sZXMgPSB0aGlzLmRldGVjdFN0cnVjdHVyYWxIb2xlcygpO1xuICAgICAgICBjb25zdCB7IGNvcmUsIHBlcmlwaGVyeSB9ID0gdGhpcy5maW5kQ29yZVBlcmlwaGVyeSgpO1xuXG4gICAgICAgIC8vIENhbGN1bGF0ZSBkZWdyZWUgY2VudHJhbGl0eVxuICAgICAgICBjb25zdCBkZWdyZWVDZW50cmFsaXR5ID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgdGhpcy5ub2Rlcy5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgICAgICAgZGVncmVlQ2VudHJhbGl0eS5zZXQobm9kZS5pZCwgdGhpcy5lZGdlcy5maWx0ZXIoZSA9PlxuICAgICAgICAgICAgICAgIGUuc291cmNlID09PSBub2RlLmlkIHx8IGUudGFyZ2V0ID09PSBub2RlLmlkXG4gICAgICAgICAgICApLmxlbmd0aCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENhbGN1bGF0ZSBjbHVzdGVyaW5nIGNvZWZmaWNpZW50c1xuICAgICAgICBjb25zdCBsb2NhbENvZWZmaWNpZW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gICAgICAgIGxldCBnbG9iYWxDb2VmZmljaWVudCA9IDA7XG5cbiAgICAgICAgdGhpcy5ub2Rlcy5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgbmVpZ2hib3JzID0gdGhpcy5lZGdlc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoZSA9PiBlLnNvdXJjZSA9PT0gbm9kZS5pZCB8fCBlLnRhcmdldCA9PT0gbm9kZS5pZClcbiAgICAgICAgICAgICAgICAubWFwKGUgPT4gZS5zb3VyY2UgPT09IG5vZGUuaWQgPyBlLnRhcmdldCA6IGUuc291cmNlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKG5laWdoYm9ycy5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICAgICAgbG9jYWxDb2VmZmljaWVudHMuc2V0KG5vZGUuaWQsIDApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHRyaWFuZ2xlcyA9IDA7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5laWdoYm9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IG5laWdoYm9ycy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lZGdlcy5zb21lKGUgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgIChlLnNvdXJjZSA9PT0gbmVpZ2hib3JzW2ldICYmIGUudGFyZ2V0ID09PSBuZWlnaGJvcnNbal0pIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAoZS5zb3VyY2UgPT09IG5laWdoYm9yc1tqXSAmJiBlLnRhcmdldCA9PT0gbmVpZ2hib3JzW2ldKVxuICAgICAgICAgICAgICAgICAgICApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlhbmdsZXMrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgY29lZmZpY2llbnQgPSAoMiAqIHRyaWFuZ2xlcykgLyAobmVpZ2hib3JzLmxlbmd0aCAqIChuZWlnaGJvcnMubGVuZ3RoIC0gMSkpO1xuICAgICAgICAgICAgbG9jYWxDb2VmZmljaWVudHMuc2V0KG5vZGUuaWQsIGNvZWZmaWNpZW50KTtcbiAgICAgICAgICAgIGdsb2JhbENvZWZmaWNpZW50ICs9IGNvZWZmaWNpZW50O1xuICAgICAgICB9KTtcblxuICAgICAgICBnbG9iYWxDb2VmZmljaWVudCAvPSB0aGlzLm5vZGVzLmxlbmd0aDtcblxuICAgICAgICAvLyBBc3NpZ24gY29tbXVuaXRpZXMgYmFzZWQgb24gY29yZS1wZXJpcGhlcnkgc3RydWN0dXJlXG4gICAgICAgIGNvbnN0IGNvbW11bml0aWVzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgY29yZS5mb3JFYWNoKG5vZGVJZCA9PiBjb21tdW5pdGllcy5zZXQobm9kZUlkLCAxKSk7XG4gICAgICAgIHBlcmlwaGVyeS5mb3JFYWNoKG5vZGVJZCA9PiBjb21tdW5pdGllcy5zZXQobm9kZUlkLCAwKSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNlbnRyYWxpdHk6IHtcbiAgICAgICAgICAgICAgICBkZWdyZWU6IGRlZ3JlZUNlbnRyYWxpdHksXG4gICAgICAgICAgICAgICAgYmV0d2Vlbm5lc3M6IG5ldyBNYXAoKSwgLy8gQ2FsY3VsYXRlZCBpbiBiYXNlIGNsYXNzXG4gICAgICAgICAgICAgICAgY2xvc2VuZXNzOiBuZXcgTWFwKCksICAgLy8gQ2FsY3VsYXRlZCBpbiBiYXNlIGNsYXNzXG4gICAgICAgICAgICAgICAgZWlnZW52ZWN0b3I6IGVpZ2VudmVjdG9yQ2VudHJhbGl0eSxcbiAgICAgICAgICAgICAgICBrYXR6OiBrYXR6Q2VudHJhbGl0eVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsdXN0ZXJpbmc6IHtcbiAgICAgICAgICAgICAgICBnbG9iYWxDb2VmZmljaWVudCxcbiAgICAgICAgICAgICAgICBsb2NhbENvZWZmaWNpZW50cyxcbiAgICAgICAgICAgICAgICBjb21tdW5pdGllc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhdGhzOiB7XG4gICAgICAgICAgICAgICAgYXZlcmFnZVBhdGhMZW5ndGg6IDAsICAgLy8gUmVxdWlyZXMgYWxsLXBhaXJzIHNob3J0ZXN0IHBhdGhzXG4gICAgICAgICAgICAgICAgZGlhbWV0ZXI6IDAsICAgICAgICAgICAgLy8gUmVxdWlyZXMgYWxsLXBhaXJzIHNob3J0ZXN0IHBhdGhzXG4gICAgICAgICAgICAgICAgZWNjZW50cmljaXR5OiBuZXcgTWFwKCkgLy8gUmVxdWlyZXMgYWxsLXBhaXJzIHNob3J0ZXN0IHBhdGhzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3BlY3RyYWw6IHNwZWN0cmFsUHJvcGVydGllc1xuICAgICAgICB9O1xuICAgIH1cbn1cbiJdfQ==
export {};
